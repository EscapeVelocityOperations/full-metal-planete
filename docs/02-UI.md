# Full Metal Planète - UI Requirements

## 1. Technology Stack

| Component | Primary | Fallback |
|-----------|---------|----------|
| Rendering | WebGPU | WebGL2 |
| Framework | Vanilla TypeScript | Preact (if needed) |
| State | Local game state | - |
| Sync | WebSocket client | - |

---

## 2. Hex Grid Rendering

### 2.1 Hex Specifications

| Property | Value |
|----------|-------|
| Orientation | **Flat-top** |
| Total hexes | 851 |
| Coordinate system (logic) | Cube coordinates |
| Coordinate system (storage) | Axial coordinates (q, r) |

### 2.2 Flat-Top Hex Geometry

```
     ___
    /   \
   /     \
   \     /
    \___/

Width  = size * 2
Height = size * sqrt(3)
```

### 2.3 Coordinate Conversion

```typescript
// Axial to Pixel (flat-top)
function axialToPixel(q: number, r: number, size: number): Point {
  const x = size * (3/2 * q);
  const y = size * (sqrt(3)/2 * q + sqrt(3) * r);
  return { x, y };
}

// Pixel to Axial (flat-top)
function pixelToAxial(x: number, y: number, size: number): HexCoord {
  const q = (2/3 * x) / size;
  const r = (-1/3 * x + sqrt(3)/3 * y) / size;
  return hexRound(q, r);
}
```

### 2.4 Hex Neighbors (Flat-Top)

```typescript
const DIRECTIONS = [
  { q: +1, r:  0 }, // East
  { q: +1, r: -1 }, // Northeast
  { q:  0, r: -1 }, // Northwest
  { q: -1, r:  0 }, // West
  { q: -1, r: +1 }, // Southwest
  { q:  0, r: +1 }, // Southeast
];
```

---

## 3. Visual Design

### 3.1 Color Palette

| Element | Hex Code | RGB |
|---------|----------|-----|
| Land | `#D4A574` | rgb(212, 165, 116) |
| Sea | `#6B7B9E` | rgb(107, 123, 158) |
| Marsh | `#B8996B` | rgb(184, 153, 107) |
| Reef | `#7A8BA8` | rgb(122, 139, 168) |
| Mountain | `#808080` | rgb(128, 128, 128) |
| Mineral | `#E55A3C` | rgb(229, 90, 60) |

### 3.2 Terrain Patterns

| Terrain | Visual Treatment |
|---------|------------------|
| Land | Solid ochre fill |
| Sea | Solid blue-purple fill |
| Marsh | Ochre base with blue spots |
| Reef | Blue base with ochre spots |
| Mountain | Grey with height shading |

### 3.3 Tide Visual Indicators

| Tide State | Marsh Display | Reef Display |
|------------|---------------|--------------|
| Low | Land color (ochre) | Land color (ochre) |
| Normal | Land color (ochre) | Sea color (blue) |
| High | Sea color (blue) | Sea color (blue) |

### 3.4 Unit Aesthetic

- **Style**: Industrial sci-fi (matching original metal miniatures)
- **Surface**: Weathered metallic textures
- **Player identification**: Colored gem/marker indicators

### 3.5 Player Colors

| Player | Primary Color | Gem Color |
|--------|---------------|-----------|
| Player 1 | Red | `#E53935` |
| Player 2 | Blue | `#1E88E5` |
| Player 3 | Green | `#43A047` |
| Player 4 | Yellow | `#FDD835` |

---

## 4. UI Components

### 4.1 Game Board (Main Canvas)

**Requirements**:
- Full WebGPU rendering pipeline
- Pan and zoom controls
- Hex highlighting on hover
- Unit selection on click
- Movement path preview
- Fire range indicators
- "Under fire" zone visualization

**Interactions**:
| Input | Action |
|-------|--------|
| Click hex | Select unit / Set destination |
| Right-click | Context menu (actions) |
| Scroll | Zoom in/out |
| Drag | Pan view |
| Hover | Highlight hex, show info |

### 4.2 HUD - Top Bar

```
┌─────────────────────────────────────────────────────────┐
│ Turn: 12/25  │  Tide: NORMAL  │  ⏱ 2:45  │  AP: 8/15   │
└─────────────────────────────────────────────────────────┘
```

| Element | Description |
|---------|-------------|
| Turn counter | Current turn / total turns |
| Tide indicator | LOW / NORMAL / HIGH + icon |
| Timer | Countdown from 3:00 |
| AP counter | Current / Max action points |

### 4.3 HUD - Side Panel (Selected Unit)

```
┌─────────────────────┐
│ TANK (Player 1)     │
├─────────────────────┤
│ Status: Active      │
│ Range: 2 hexes      │
│ Shots: 2/2          │
├─────────────────────┤
│ Actions:            │
│ [Move] [Fire] [...]│
└─────────────────────┘
```

For transporters:
```
┌─────────────────────┐
│ BARGE (Player 1)    │
├─────────────────────┤
│ Cargo: 2/4 slots    │
│ ├─ Tank             │
│ └─ Mineral          │
├─────────────────────┤
│ [Load] [Unload]     │
└─────────────────────┘
```

### 4.4 HUD - Player Status Bar

```
┌─────────────────────────────────────────────┐
│ P1 ●  Score: 24  │  P2 ○  Score: 18  │ ... │
└─────────────────────────────────────────────┘
```

- Current player highlighted
- Show scores (minerals × 2 + equipment)
- Show if player has lifted off

### 4.5 Game Controls

```
┌─────────────────────────────────────┐
│ [End Turn]  [Undo]  [Settings ⚙]   │
└─────────────────────────────────────┘
```

| Control | Function |
|---------|----------|
| End Turn | Voluntarily end turn, save remaining AP |
| Undo | Revert last action (if rules allow) |
| Settings | Open settings modal |

### 4.6 Tide Prediction Panel

Only shown if player has operational Converter:

```
┌─────────────────────┐
│ Next Tide: HIGH     │
│ (Converter active)  │
└─────────────────────┘
```

### 4.7 Turn 21 Decision Modal

```
┌───────────────────────────────────────┐
│         TURN 21 - LIFT OFF?           │
├───────────────────────────────────────┤
│                                       │
│   Your Astronef contains:             │
│   • 8 minerals (16 pts)               │
│   • 3 tanks (3 pts)                   │
│   • 3 turrets (3 pts)                 │
│   Total: 22 points                    │
│                                       │
│   [LIFT OFF NOW]   [STAY TO TURN 25]  │
│                                       │
└───────────────────────────────────────┘
```

### 4.8 Lobby / Game Setup

```
┌───────────────────────────────────────────────────┐
│              FULL METAL PLANÈTE                   │
├───────────────────────────────────────────────────┤
│                                                   │
│   Game Link:                                      │
│   ┌─────────────────────────────────────┐        │
│   │ https://fmp.game/abc123             │ [Copy] │
│   └─────────────────────────────────────┘        │
│                                                   │
│   Players:                                        │
│   ● Player 1 (Host)     [Ready ✓]                │
│   ○ Player 2            [Ready ✓]                │
│   ○ Waiting...                                   │
│   ○ Waiting...                                   │
│                                                   │
│   [Start Game]  (2-4 players required)           │
│                                                   │
└───────────────────────────────────────────────────┘
```

---

## 5. Visual Feedback

### 5.1 Movement

| State | Visual |
|-------|--------|
| Selected unit | Glowing outline |
| Valid move hexes | Green highlight |
| Invalid move hexes | Red overlay |
| Movement path | Dotted line |
| AP cost preview | Number on destination hex |

### 5.2 Combat

| State | Visual |
|-------|--------|
| Unit in range | Orange border |
| "Under fire" hex | Red diagonal stripes |
| Fire action | Line from attackers to target |
| Destruction | Explosion animation + fade out |
| Capture | Color transition animation |

### 5.3 Tide Changes

| Event | Visual |
|-------|--------|
| Tide changing | Wave animation across board |
| Marsh flooding | Blue wash over ochre |
| Reef emerging | Ochre rising from blue |
| Unit stuck | Warning icon + shake animation |

### 5.4 Turn Transitions

| Event | Visual |
|-------|--------|
| Turn start | Player color flash |
| Timer warning | Red pulsing at 30s, 10s |
| Turn end | Fade to next player |

---

## 6. Rendering Architecture

### 6.1 WebGPU Pipeline

```
┌─────────────────────────────────────────────────┐
│                   Render Loop                    │
├─────────────────────────────────────────────────┤
│                                                  │
│  1. Clear canvas                                 │
│  2. Render terrain layer (instanced hexes)       │
│  3. Render mineral layer                         │
│  4. Render unit layer (sorted by y-position)     │
│  5. Render UI overlay                            │
│  6. Render selection/highlight effects           │
│                                                  │
└─────────────────────────────────────────────────┘
```

### 6.2 Shader Requirements

| Shader | Purpose |
|--------|---------|
| Hex terrain | Render 851 hexes with terrain colors |
| Hex highlight | Selection, hover, range indicators |
| Sprite | Unit rendering with player colors |
| Water effect | Animated sea surface |
| Transition | Tide change animations |

### 6.3 WebGL2 Fallback

If WebGPU unavailable:
- Use WebGL2 with similar pipeline
- Reduce shader complexity
- Disable some visual effects

Feature detection:
```typescript
async function initRenderer(): Promise<Renderer> {
  if (navigator.gpu) {
    const adapter = await navigator.gpu.requestAdapter();
    if (adapter) {
      return new WebGPURenderer(adapter);
    }
  }
  return new WebGL2Renderer();
}
```

---

## 7. Responsive Design

### 7.1 Breakpoints

| Breakpoint | Layout |
|------------|--------|
| Desktop (≥1200px) | Full layout, side panel |
| Tablet (768-1199px) | Collapsible side panel |
| Mobile (<768px) | Bottom sheet UI, touch controls |

### 7.2 Touch Controls

| Gesture | Action |
|---------|--------|
| Tap | Select |
| Long press | Context menu |
| Pinch | Zoom |
| Two-finger drag | Pan |

---

## 8. Accessibility

### 8.1 Requirements

- Keyboard navigation for all actions
- Screen reader support for game state
- High contrast mode option
- Color-blind friendly palette option

### 8.2 Keyboard Shortcuts

| Key | Action |
|-----|--------|
| Tab | Cycle through units |
| Enter | Confirm action |
| Escape | Cancel / Deselect |
| Space | End turn |
| 1-9 | Quick select unit |
| Arrow keys | Pan view |
| +/- | Zoom |

---

## 9. Performance Targets

| Metric | Target |
|--------|--------|
| Frame rate | 60 FPS |
| Initial load | < 3 seconds |
| Input latency | < 16ms |
| Memory usage | < 200MB |

---

## 10. Asset Requirements

### 10.1 Unit Sprites

| Unit | Sprite Size | Animations |
|------|-------------|------------|
| Tank | 64×64 | Idle, Move, Fire |
| Super Tank | 80×80 | Idle, Move, Fire |
| Motor Boat | 64×64 | Idle, Move, Fire |
| Barge | 96×64 | Idle, Move |
| Crab | 64×64 | Idle, Move |
| Converter | 64×64 | Idle, Build |
| Bridge | 64×64 | Static |
| Astronef | 192×192 | Idle, Landing, Takeoff |
| Mineral | 32×32 | Static |

### 10.2 UI Assets

- Tide icons (low/normal/high)
- Player color markers
- Action button icons
- Hex highlight textures
- Explosion/capture effects

---

## 11. Sound Design (Optional)

### 11.1 Sound Effects

| Event | Sound |
|-------|-------|
| Unit select | Click |
| Unit move | Engine/tracks |
| Fire | Laser/cannon |
| Destruction | Explosion |
| Capture | Power-up |
| Tide change | Water wave |
| Turn start | Bell/chime |
| Timer warning | Tick/beep |

### 11.2 Music

- Ambient sci-fi background
- Intensity increase during combat
- Victory/defeat themes
