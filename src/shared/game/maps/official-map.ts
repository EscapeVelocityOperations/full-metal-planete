/**
 * Official Full Metal Planète Map
 *
 * Recreated from the original board game map (docs/offical.jpg)
 * 37x23 hexagonal grid with odd-r offset layout (851 total hexes)
 *
 * Legend from original:
 * - Cases montagne (Mountain) = orange hexes
 * - Cases mer (Sea) = black hexes
 * - Cases marécages (Marsh) = white hexes with small dot
 * - Cases récifs (Reef) = white hexes with filled dot
 * - Cases plaines (Land) = white/empty hexes
 */

import { TerrainType, type HexTerrain } from "../types";

// Compact terrain encoding for readability:
// S = Sea, L = Land, M = Mountain, W = Marsh (Wetland), R = Reef
type TerrainCode = "S" | "L" | "M" | "W" | "R";

const TERRAIN_MAP: Record<TerrainCode, TerrainType> = {
  S: TerrainType.Sea,
  L: TerrainType.Land,
  M: TerrainType.Mountain,
  W: TerrainType.Marsh,
  R: TerrainType.Reef,
};

// Map data encoded row by row (r=0 to r=22), each row has 37 columns (q=0 to q=36)
// Carefully mapped from docs/offical.jpg
// The map shows an island with central landmass surrounded by sea
const OFFICIAL_MAP_DATA: TerrainCode[][] = [
  // Legend:
  // 'S' = Sea (Mer) - Black
  // 'L' = Plains (Plaine) - White
  // 'M' = Mountain (Montagne) - Orange
  // 'W' = Swamp (Marécage) - White with dot
  // 'R' = Reef (Récif) - Black with dot

  [
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 1
  [
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 2
  [
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
    "L",
    "L",
    "L",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "L",
    "L",
    "L",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 3
  [
    "L",
    "M",
    "M",
    "L",
    "L",
    "L",
    "M",
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "M",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 4
  [
    "M",
    "M",
    "L",
    "L",
    "L",
    "M",
    "L",
    "L",
    "W",
    "W",
    "S",
    "S",
    "R",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "R",
    "S",
    "S",
    "W",
    "W",
    "L",
    "L",
    "L",
    "M",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 5
  [
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
  ],
  // Row 6
  [
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "R",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "M",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "R",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
    "M",
  ],
  // Row 7
  [
    "L",
    "L",
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
  ],
  // Row 8
  [
    "L",
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 9
  [
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "R",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "R",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 10
  [
    "L",
    "M",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "M",
    "L",
    "L",
  ],
  // Row 11
  [
    "M",
    "M",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "M",
    "M",
    "L",
    "L",
    "S",
    "S",
    "S",
    "L",
    "L",
    "M",
    "M",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "M",
    "L",
    "L",
  ],
  // Row 12
  [
    "M",
    "L",
    "S",
    "S",
    "R",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "M",
    "M",
    "M",
    "M",
    "L",
    "S",
    "S",
    "S",
    "L",
    "M",
    "M",
    "M",
    "M",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "R",
    "S",
    "L",
    "M",
    "L",
  ],
  // Row 13
  [
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
    "L",
    "L",
    "S",
    "S",
    "S",
    "L",
    "L",
    "M",
    "M",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
  ],
  // Row 14
  [
    "L",
    "L",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
  ],
  // Row 15
  [
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "R",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "R",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "R",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 16
  [
    "M",
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "M",
    "L",
  ],
  // Row 17
  [
    "M",
    "M",
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "L",
    "L",
    "S",
    "S",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "M",
    "M",
    "L",
  ],
  // Row 18
  [
    "M",
    "M",
    "M",
    "L",
    "L",
    "L",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
    "L",
  ],
  // Row 19
  [
    "L",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
    "W",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "R",
    "S",
    "S",
    "S",
    "R",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "W",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 20
  [
    "L",
    "L",
    "L",
    "L",
    "M",
    "L",
    "L",
    "L",
    "L",
    "W",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "W",
    "L",
    "L",
    "L",
    "L",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 21
  [
    "L",
    "L",
    "L",
    "M",
    "M",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "W",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "W",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "M",
    "L",
    "L",
    "L",
    "L",
  ],
  // Row 22
  [
    "L",
    "L",
    "L",
    "L",
    "M",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "W",
    "W",
    "S",
    "S",
    "S",
    "S",
    "S",
    "W",
    "W",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "L",
    "M",
    "L",
    "L",
    "L",
    "L",
  ],
];

/**
 * Generate the official Full Metal Planète map
 * @returns Array of HexTerrain for all 851 hexes
 */
export function generateOfficialMap(): HexTerrain[] {
  const terrain: HexTerrain[] = [];

  for (let r = 0; r < OFFICIAL_MAP_DATA.length; r++) {
    const row = OFFICIAL_MAP_DATA[r];
    for (let q = 0; q < row.length; q++) {
      const code = row[q];
      terrain.push({
        coord: { q, r },
        type: TERRAIN_MAP[code],
      });
    }
  }

  return terrain;
}

/**
 * Get map dimensions
 */
export const OFFICIAL_MAP_DIMENSIONS = {
  width: 37,
  height: 23,
  totalHexes: 851,
};

/**
 * Validate official map data integrity
 */
export function validateOfficialMap(): { valid: boolean; errors: string[] } {
  const errors: string[] = [];

  // Check row count
  if (OFFICIAL_MAP_DATA.length !== 23) {
    errors.push(`Expected 23 rows, got ${OFFICIAL_MAP_DATA.length}`);
  }

  // Check column count for each row
  OFFICIAL_MAP_DATA.forEach((row, r) => {
    if (row.length !== 37) {
      errors.push(`Row ${r}: expected 37 columns, got ${row.length}`);
    }
  });

  // Count terrain types
  const counts: Record<TerrainCode, number> = { S: 0, L: 0, M: 0, W: 0, R: 0 };
  OFFICIAL_MAP_DATA.forEach((row) => {
    row.forEach((code) => {
      counts[code]++;
    });
  });

  // Verify total hexes
  const total = Object.values(counts).reduce((a, b) => a + b, 0);
  if (total !== 851) {
    errors.push(`Expected 851 total hexes, got ${total}`);
  }

  return {
    valid: errors.length === 0,
    errors,
  };
}

/**
 * Get terrain statistics for the official map
 */
export function getOfficialMapStats(): Record<string, number> {
  const counts: Record<string, number> = {
    sea: 0,
    land: 0,
    mountain: 0,
    marsh: 0,
    reef: 0,
  };

  const codeToName: Record<TerrainCode, string> = {
    S: "sea",
    L: "land",
    M: "mountain",
    W: "marsh",
    R: "reef",
  };

  OFFICIAL_MAP_DATA.forEach((row) => {
    row.forEach((code) => {
      counts[codeToName[code]]++;
    });
  });

  return counts;
}
